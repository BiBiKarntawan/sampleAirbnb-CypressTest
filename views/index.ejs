<!DOCTYPE html>
<html>
<head>
  <title>Simple Airbnb Search</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Simple Airbnb Available Lists</h1>
      <h2>Search for Properties</h2>

      <!--  Search Form -->
      <form action="/" method="GET" class="search-form">
        <label>Location (required)</label>
        <input type="text" name="location" placeholder="Enter city (e.g. Barcelona)" value="<%= filters?.location || '' %>" required>

        <label>Property Type</label>
        <select name="propertyType">
          <option value="">Any</option>
          <option value="Apartment">Apartment</option>
          <option value="House">House</option>
          <option value="Condominium">Condominium</option>
          <option value="Loft">Loft</option>
        </select>

        <label>Bedrooms</label>
        <select name="bedrooms">
          <option value="">Any</option>
          <option value="1">1 Bedroom</option>
          <option value="2">2 Bedrooms</option>
          <option value="3">3 Bedrooms</option>
          <option value="4">4+ Bedrooms</option>
        </select>
        <div>
          <button type="submit">Search</button>
        </div>
      </form>

      <hr>

      <!-- Results -->
      <% if (listings.length > 0) { %>
        <% if (filters?.location) { %>
          <h2><%= listings.length %> result(s) found</h2>
        <% } %>
        <% listings.forEach(listing => { %>
          <div class="listing-box">
            <h3>
              <a href="/booking?listing_id=<%= listing._id %>"><%= listing.name %></a>
            </h3>

            <p><strong>Location:</strong> <%= listing.address?.market || 'Unknown' %></p>

            <p><strong>Summary:</strong> <%= listing.summary || 'No summary available.' %></p>
            <p><strong>Price:</strong> $<%= listing.price || 'N/A' %></p>
            <p><strong>Customer Rating:</strong> <%= listing.review_scores?.review_scores_rating || 'Not rated' %></p>
          </div>
        <% }) %>

      <% } else { %>
        <p>No listings found. Try a different location.</p>
      <% } %>
    </div>
  </div>
</body>
</html>
